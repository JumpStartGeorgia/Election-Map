<% if @table_data.present? && @table_data.data.present? %>
	<% data = @table_data.data %>

    <% default_cols_show = 5 %>

    <div id="data_table_filter_container">
      <select id="data_table_filter" class="event_filter_select chzn-select" multiple>
			  <% @table_data.titles.each_with_index do |title, i| %>
			    <% selected = i < default_cols_show ? 'selected="selected"'.html_safe : '' %>
			    <option <%= selected %> data-i="<%= (i + 1) %>" value="<%= i %>"><%= title %></option>
			  <% end %>
      </select>
    </div>

		<table id="map_data_table" class="table table-striped">
		 <thead>
		  <tr>
		    <% data[0].each_with_index do |value, i| %>
		      <th data-i="<%= i %>" <%= (i > default_cols_show) ? ('class="hidden"').html_safe : '' %>>
		        <span><%= value %></span>
		      </th>
		    <% end %>
		  </tr>
		 </thead>

		 <tbody>
		  <% data[1..(data.length - 1)].each do |row| %>
		    <tr>
		      <% row.each_with_index do |value, i| %>
		        <td data-i="<%= i %>" <%= (i > default_cols_show) ? ('class="hidden"').html_safe : '' %>>
		          <% if i == 0 %>
		            <span><%= value %></span>
		          <% elsif i == 1 && @table_data.indicator_type_ids.present?%>
		            <%= link_to value, summary_map_path(:event_type_id => params[:event_type_id],
										:event_id => params[:event_id], :shape_type_id => params[:shape_type_id],
										:shape_id => params[:shape_id], :indicator_type_id => @table_data.indicator_type_ids[data[0][i]],
										:view_type => @summary_view_type_name, :custom_view => params[:custom_view],
										:data_type => params[:data_type], :data_set_id => params[:data_set_id],
										:highlight_shape => row[0], :indicator_id => nil) %>
		          <% else %>
		            <%= link_to(value, indicator_map_path(:event_type_id => params[:event_type_id],
										:event_id => params[:event_id], :shape_id => params[:shape_id],
										:shape_type_id => params[:shape_type_id], :indicator_id => @table_data.indicator_ids[i],
										:custom_view => params[:custom_view], :highlight_shape => row[0],
										:data_type => params[:data_type], :data_set_id => params[:data_set_id], 
                    :indicator_type_id => nil)) %>
		          <% end %>
		        </td>
		      <% end %>
		    </tr>
		  <% end %>
		 </tbody>
		</table>


	<script type="text/javascript">
    // create file name for downloads
    var file_name = $('.navmenu-select p').html();

    $(document).ready(function(){
	    $('#map_data_table').dataTable({
        "sDom": "<'row-fluid'<'span6'f><'span6'T>r>t<'row-fluid'<'span5'i><'span2'l><'span5'p>>",    
        "sPaginationType": "bootstrap",
        "bJQueryUI": false,
        "bProcessing": true,
        "bStateSave": true,
        "bAutoWidth": false,
        "oLanguage": {
          "sUrl": gon.datatable_i18n_url
        },
        "iDisplayLength": 20,
        "aLengthMenu": [[20, 40, 60, 80], [20, 40, 60, 80]],
        "oTableTools": {
			    "aButtons": [
            {
              "sExtends": "csv",
              "sTitle": file_name + " - csv"
            },
            {
              "sExtends": "xls",
              "sTitle": file_name + " - xls"
            }
			    ]
		    }
        
      });
    });
    

	</script>
	<script type="text/javascript" src="/assets/data_table.js"></script>
<% end %>
